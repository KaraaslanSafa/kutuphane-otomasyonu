<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Favori Kitaplar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4 shadow">
    <a class="navbar-brand fw-bold" href="/index.html"><i class="fas fa-heart"></i> Favori Kitaplar</a>
    <div class="ms-auto d-flex align-items-center">
        <a href="/index.html" class="btn btn-sm btn-outline-light me-2">
            <i class="fas fa-home"></i> Ana Sayfa
        </a>
        <button onclick="cikisYap()" class="btn btn-sm btn-outline-light">Çıkış</button>
    </div>
</nav>

<div class="container mt-4">
    <h3 class="mb-4"><i class="fas fa-heart text-danger"></i> Favori Kitaplarım</h3>
    <div class="row row-cols-1 row-cols-md-4 g-4" id="favoriListesi">
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
        </div>
    </div>
</div>

<!-- Dark Mode Toggle -->
<button class="theme-toggle" onclick="toggleTheme()" title="Tema Değiştir">
    <i class="fas fa-moon" id="themeIcon"></i>
</button>

<script>
    const currentUser = JSON.parse(localStorage.getItem("user"));

    if (!currentUser) {
        window.location.href = "/login.html";
    } else {
        favorileriGetir();
    }

    function cikisYap() {
        localStorage.removeItem("user");
        window.location.href = "/login.html";
    }

    function favorileriGetir() {
        fetch(`/api/favori/kullanici/${currentUser.id}`)
            .then(res => res.json())
            .then(kitaplar => {
                const liste = document.getElementById("favoriListesi");
                if (kitaplar.length === 0) {
                    liste.innerHTML = '<div class="col-12"><div class="alert alert-info">Henüz favori kitabınız yok.</div></div>';
                } else {
                    liste.innerHTML = "";
                    kitaplar.forEach(kitap => {
                        const resim = kitap.resimUrl || "https://via.placeholder.com/150";
                        liste.innerHTML += `
                            <div class="col">
                                <div class="card h-100 shadow-sm border-0 modern-card">
                                    <a href="/detay.html?id=${kitap.id}">
                                        <img src="${resim}" class="card-img-top" style="height: 200px; object-fit: cover; cursor: pointer;">
                                    </a>
                                    <div class="card-body">
                                        <a href="/detay.html?id=${kitap.id}" style="text-decoration: none; color: inherit;">
                                            <h6 class="card-title fw-bold">${kitap.ad}</h6>
                                            <p class="card-text small text-muted">${kitap.yazar}</p>
                                        </a>
                                        <button onclick="favoridenCikar(${kitap.id})" class="btn btn-sm btn-danger w-100">
                                            <i class="fas fa-heart-broken"></i> Favorilerden Çıkar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
            });
    }

    function favoridenCikar(kitapId) {
        if (!confirm("Bu kitabı favorilerden çıkarmak istediğinize emin misiniz?")) {
            return;
        }
        fetch(`/api/favori/cikar?kullaniciId=${currentUser.id}&kitapId=${kitapId}`, {method: 'DELETE'})
            .then(() => {
                favorileriGetir();
            });
    }

    // Dark Mode
    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    }

    function updateThemeIcon(theme) {
        const icon = document.getElementById('themeIcon');
        if (icon) {
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
    });
</script>

</body>
</html>

