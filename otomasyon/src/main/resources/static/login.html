<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GiriÅŸ Yap / KayÄ±t Ol</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        [data-theme="dark"] body { background: linear-gradient(135deg, #0f1a2e 0%, #1a2d4d 100%); }
        .card { width: 400px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .btn-primary { background-color: #0d6efd; border: none; font-weight: bold; }
        .btn-primary:hover { background-color: #0b5ed7; }
        .nav-tabs { border-bottom: 2px solid #dee2e6; }
        .nav-tabs .nav-link { color: #6c757d; border: none; }
        .nav-tabs .nav-link.active { color: #0d6efd; border-bottom: 2px solid #0d6efd; font-weight: bold; }
        .tab-content { margin-top: 20px; }
    </style>
</head>
<body>

<div class="card p-4 bg-white">
    <div class="text-center mb-4"><h3 class="text-dark fw-bold">ðŸ“š KÃ¼tÃ¼phane</h3></div>
    
    <!-- Sekmeler -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="giris-tab" data-bs-toggle="tab" data-bs-target="#giris" type="button" role="tab">GiriÅŸ Yap</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="kayit-tab" data-bs-toggle="tab" data-bs-target="#kayit" type="button" role="tab">KayÄ±t Ol</button>
        </li>
    </ul>

    <!-- Sekme Ä°Ã§erikleri -->
    <div class="tab-content">
        <!-- GiriÅŸ Sekmesi -->
        <div class="tab-pane fade show active" id="giris" role="tabpanel">
            <form onsubmit="event.preventDefault(); girisYap();">
                <div class="mb-3"><input type="email" id="email" class="form-control" placeholder="admin@kutuphane.com" required></div>
                <div class="mb-3"><input type="password" id="sifre" class="form-control" placeholder="â€¢â€¢â€¢â€¢" required></div>
                <button type="submit" class="btn btn-primary w-100 py-2">GiriÅŸ Yap</button>
                <div class="text-center mt-3"><a href="#" class="text-decoration-none small text-muted">Åžifremi Unuttum</a></div>
            </form>
        </div>

        <!-- KayÄ±t Sekmesi -->
        <div class="tab-pane fade" id="kayit" role="tabpanel">
            <form onsubmit="event.preventDefault(); kayitOl();">
                <div class="mb-2"><input type="text" id="kayitAdSoyad" class="form-control" placeholder="Ad Soyad" required></div>
                <div class="mb-2"><input type="email" id="kayitEmail" class="form-control" placeholder="E-posta" required></div>
                <div class="mb-2"><input type="password" id="kayitSifre" class="form-control" placeholder="Åžifre" required></div>
                <div class="mb-3">
                    <select id="kayitTip" class="form-select">
                        <option value="UYE">Ã–ÄŸrenci / Ãœye</option>
                        <option value="PERSONEL">YÃ¶netici / Personel</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success w-100 py-2">KayÄ±t Ol</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function girisYap() {
        const emailGiris = document.getElementById("email").value; // Girilen emaili al
        const sifreGiris = document.getElementById("sifre").value;

        const veri = { email: emailGiris, sifre: sifreGiris };

        fetch('/api/giris', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(veri)
        })
        .then(response => {
            if (!response.ok) throw new Error("GiriÅŸ baÅŸarÄ±sÄ±z");
            return response.json();
        })
        .then(kullanici => {
            if (kullanici) {
                // KullanÄ±cÄ±yÄ± kaydet
                localStorage.setItem("user", JSON.stringify(kullanici));

                // --- ðŸš¨ ZORLA YÃ–NLENDÄ°RME (BURASI DEÄžÄ°ÅžTÄ°) ðŸš¨ ---
                // Java'dan gelen veriye bakmaksÄ±zÄ±n, email admin ise direkt admine atÄ±yoruz.
                if (emailGiris === "admin@kutuphane.com") {
                    console.log("Admin tespit edildi! Panele yÃ¶nlendiriliyor...");
                    window.location.href = "/admin.html";
                } 
                else if (kullanici.kullaniciTipi === "PERSONEL") {
                    window.location.href = "/admin.html";
                } 
                else {
                    window.location.href = "/index.html";
                }
                // -----------------------------------------------
            } else {
                alert("HatalÄ± GiriÅŸ!");
            }
        })
        .catch(error => {
            console.error("Hata:", error);
            alert("GiriÅŸ yapÄ±lamadÄ±! LÃ¼tfen bilgileri kontrol et.");
        });
    }

    function kayitOl() {
        const veri = {
            adSoyad: document.getElementById("kayitAdSoyad").value,
            email: document.getElementById("kayitEmail").value,
            sifre: document.getElementById("kayitSifre").value,
            kullaniciTipi: document.getElementById("kayitTip").value
        };

        fetch('/api/kayit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(veri)
        })
        .then(res => {
            if (res.ok) {
                alert("KayÄ±t baÅŸarÄ±lÄ±! GiriÅŸ sekmesine geÃ§ebilirsiniz.");
                // GiriÅŸ sekmesine geÃ§
                const girisTab = new bootstrap.Tab(document.getElementById('giris-tab'));
                girisTab.show();
                // Form alanlarÄ±nÄ± temizle
                document.getElementById("kayitAdSoyad").value = "";
                document.getElementById("kayitEmail").value = "";
                document.getElementById("kayitSifre").value = "";
            } else {
                alert("KayÄ±t sÄ±rasÄ±nda bir hata oluÅŸtu. (Bu e-posta zaten kullanÄ±mda olabilir)");
            }
        })
        .catch(error => {
            console.error("Hata:", error);
            alert("KayÄ±t yapÄ±lamadÄ±! LÃ¼tfen bilgileri kontrol et.");
        });
    }
</script>

<!-- Dark Mode Toggle Button -->
<button class="theme-toggle" onclick="toggleTheme()" title="Tema DeÄŸiÅŸtir" style="position: fixed; bottom: 20px; right: 20px;">
    <i class="fas fa-moon" id="themeIcon"></i>
</button>

<script>
    // Dark Mode Toggle
    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    }

    function updateThemeIcon(theme) {
        const icon = document.getElementById('themeIcon');
        if (icon) {
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
    }

    // Sayfa yÃ¼klendiÄŸinde tema yÃ¼kle
    document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
    });
</script>

</body>
</html>